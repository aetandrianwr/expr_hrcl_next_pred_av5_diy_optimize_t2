  0%|          | 0/182 [00:00<?, ?it/s]  1%|          | 2/182 [00:01<01:39,  1.80it/s]  2%|▏         | 3/182 [00:01<01:44,  1.71it/s]  3%|▎         | 5/182 [00:01<00:56,  3.11it/s]  4%|▍         | 7/182 [00:02<00:56,  3.11it/s]  5%|▌         | 10/182 [00:03<00:51,  3.33it/s]  7%|▋         | 13/182 [00:04<00:54,  3.07it/s]  8%|▊         | 14/182 [00:04<00:54,  3.06it/s]  9%|▉         | 17/182 [00:04<00:34,  4.79it/s] 10%|█         | 19/182 [00:05<00:30,  5.41it/s] 12%|█▏        | 21/182 [00:05<00:33,  4.77it/s] 13%|█▎        | 23/182 [00:06<00:30,  5.13it/s] 13%|█▎        | 24/182 [00:06<00:48,  3.25it/s] 15%|█▍        | 27/182 [00:07<00:51,  3.03it/s] 16%|█▌        | 29/182 [00:08<00:38,  3.95it/s] 16%|█▋        | 30/182 [00:18<05:12,  2.06s/it] 17%|█▋        | 31/182 [00:19<04:14,  1.68s/it] 18%|█▊        | 32/182 [00:19<03:21,  1.35s/it] 18%|█▊        | 33/182 [00:19<02:52,  1.16s/it] 19%|█▊        | 34/182 [00:19<02:11,  1.12it/s] 21%|██        | 38/182 [00:23<02:08,  1.12it/s] 21%|██▏       | 39/182 [00:24<02:01,  1.18it/s] 23%|██▎       | 41/182 [00:28<03:11,  1.36s/it] 23%|██▎       | 42/182 [00:31<03:31,  1.51s/it] 24%|██▎       | 43/182 [00:31<02:52,  1.24s/it] 24%|██▍       | 44/182 [00:31<02:16,  1.01it/s] 25%|██▍       | 45/182 [00:31<01:49,  1.25it/s] 26%|██▌       | 47/182 [00:32<01:15,  1.78it/s] 27%|██▋       | 49/182 [00:33<01:12,  1.85it/s] 27%|██▋       | 50/182 [00:33<01:17,  1.70it/s] 28%|██▊       | 51/182 [00:34<01:02,  2.09it/s] 29%|██▊       | 52/182 [00:43<05:54,  2.72s/it] 29%|██▉       | 53/182 [00:44<04:47,  2.23s/it] 30%|███       | 55/182 [00:45<03:04,  1.45s/it] 31%|███       | 56/182 [00:48<04:09,  1.98s/it] 31%|███▏      | 57/182 [00:49<03:15,  1.56s/it] 32%|███▏      | 58/182 [00:49<02:30,  1.21s/it] 32%|███▏      | 59/182 [00:52<03:37,  1.77s/it] 33%|███▎      | 60/182 [00:52<02:38,  1.30s/it] 34%|███▍      | 62/182 [00:52<01:31,  1.31it/s] 35%|███▍      | 63/182 [00:53<01:31,  1.31it/s] 36%|███▌      | 65/182 [00:56<01:59,  1.02s/it] 36%|███▋      | 66/182 [00:57<02:02,  1.06s/it] 37%|███▋      | 68/182 [00:57<01:15,  1.50it/s] 38%|███▊      | 69/182 [00:58<01:03,  1.78it/s] 38%|███▊      | 70/182 [00:59<01:14,  1.51it/s] 39%|███▉      | 71/182 [00:59<00:59,  1.85it/s] 40%|████      | 73/182 [01:00<01:03,  1.72it/s] 41%|████      | 75/182 [01:00<00:47,  2.24it/s] 42%|████▏     | 76/182 [01:02<01:18,  1.35it/s] 42%|████▏     | 77/182 [01:02<01:04,  1.62it/s] 43%|████▎     | 79/182 [01:03<00:40,  2.54it/s] 45%|████▍     | 81/182 [01:03<00:32,  3.12it/s] 45%|████▌     | 82/182 [01:04<00:41,  2.43it/s] 46%|████▌     | 83/182 [01:04<00:39,  2.50it/s] 46%|████▌     | 84/182 [01:04<00:39,  2.47it/s] 47%|████▋     | 85/182 [01:05<00:33,  2.86it/s] 48%|████▊     | 87/182 [01:05<00:21,  4.38it/s] 49%|████▉     | 89/182 [01:07<00:46,  2.02it/s] 49%|████▉     | 90/182 [01:07<00:40,  2.29it/s] 50%|█████     | 91/182 [01:08<00:47,  1.91it/s] 52%|█████▏    | 95/182 [01:08<00:21,  4.12it/s] 54%|█████▍    | 98/182 [01:09<00:19,  4.27it/s] 55%|█████▌    | 101/182 [01:11<00:40,  2.00it/s] 56%|█████▌    | 102/182 [01:12<00:36,  2.17it/s] 57%|█████▋    | 103/182 [01:12<00:32,  2.46it/s] 57%|█████▋    | 104/182 [01:12<00:27,  2.82it/s] 58%|█████▊    | 106/182 [01:12<00:22,  3.31it/s] 59%|█████▉    | 107/182 [01:13<00:20,  3.62it/s] 59%|█████▉    | 108/182 [01:15<00:50,  1.48it/s] 60%|██████    | 110/182 [01:15<00:31,  2.31it/s] 62%|██████▏   | 112/182 [01:17<00:42,  1.65it/s] 63%|██████▎   | 114/182 [01:17<00:34,  1.97it/s] 64%|██████▎   | 116/182 [01:17<00:25,  2.63it/s] 64%|██████▍   | 117/182 [01:19<00:36,  1.80it/s] 65%|██████▌   | 119/182 [01:19<00:24,  2.58it/s] 66%|██████▌   | 120/182 [01:19<00:24,  2.48it/s] 66%|██████▋   | 121/182 [01:22<00:50,  1.22it/s] 67%|██████▋   | 122/182 [01:22<00:49,  1.22it/s] 68%|██████▊   | 124/182 [01:23<00:34,  1.70it/s] 69%|██████▊   | 125/182 [01:26<01:03,  1.11s/it] 70%|██████▉   | 127/182 [01:26<00:39,  1.39it/s] 70%|███████   | 128/182 [01:26<00:34,  1.58it/s] 71%|███████   | 129/182 [01:27<00:26,  1.97it/s] 72%|███████▏  | 131/182 [01:27<00:24,  2.08it/s] 73%|███████▎  | 132/182 [01:28<00:22,  2.22it/s] 73%|███████▎  | 133/182 [01:28<00:18,  2.66it/s] 74%|███████▍  | 135/182 [01:32<00:45,  1.03it/s] 76%|███████▌  | 138/182 [01:32<00:24,  1.83it/s] 76%|███████▋  | 139/182 [01:32<00:20,  2.10it/s] 78%|███████▊  | 142/182 [01:32<00:12,  3.31it/s] 79%|███████▊  | 143/182 [01:33<00:17,  2.26it/s] 79%|███████▉  | 144/182 [01:33<00:15,  2.48it/s] 80%|████████  | 146/182 [01:34<00:15,  2.37it/s] 81%|████████  | 147/182 [01:35<00:14,  2.44it/s] 81%|████████▏ | 148/182 [01:35<00:13,  2.56it/s] 82%|████████▏ | 149/182 [01:35<00:12,  2.68it/s] 82%|████████▏ | 150/182 [01:39<00:34,  1.08s/it] 84%|████████▎ | 152/182 [01:39<00:19,  1.51it/s] 85%|████████▍ | 154/182 [01:41<00:21,  1.31it/s] 86%|████████▋ | 157/182 [01:42<00:15,  1.57it/s] 87%|████████▋ | 158/182 [01:42<00:13,  1.72it/s] 88%|████████▊ | 161/182 [01:44<00:13,  1.58it/s] 89%|████████▉ | 162/182 [01:45<00:11,  1.79it/s] 90%|████████▉ | 163/182 [01:45<00:09,  2.01it/s] 90%|█████████ | 164/182 [01:45<00:08,  2.06it/s] 92%|█████████▏| 167/182 [01:46<00:05,  2.82it/s] 93%|█████████▎| 169/182 [01:46<00:03,  3.37it/s] 94%|█████████▍| 171/182 [01:47<00:02,  4.06it/s] 95%|█████████▌| 173/182 [01:47<00:02,  4.16it/s] 96%|█████████▌| 174/182 [01:50<00:05,  1.38it/s] 96%|█████████▌| 175/182 [01:52<00:06,  1.11it/s] 97%|█████████▋| 176/182 [01:52<00:04,  1.36it/s] 98%|█████████▊| 178/182 [01:52<00:01,  2.14it/s] 99%|█████████▉| 180/182 [01:52<00:00,  3.10it/s]100%|██████████| 182/182 [01:53<00:00,  2.82it/s]100%|██████████| 182/182 [01:53<00:00,  1.61it/s]
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/positionfixes.py:113: UserWarning: 146900 duplicates were dropped from your positionfixes. Dropping duplicates is recommended but can be prevented using the 'exclude_duplicate_pfs' flag.
  warnings.warn(warn_str)
  0%|          | 0/182 [00:00<?, ?it/s]  1%|          | 1/182 [00:02<06:41,  2.22s/it]  7%|▋         | 12/182 [00:03<00:36,  4.64it/s] 13%|█▎        | 24/182 [00:06<00:40,  3.88it/s] 20%|█▉        | 36/182 [00:10<00:41,  3.53it/s] 26%|██▋       | 48/182 [00:14<00:42,  3.19it/s] 33%|███▎      | 60/182 [00:19<00:40,  3.00it/s] 40%|███▉      | 72/182 [00:20<00:28,  3.83it/s] 46%|████▌     | 84/182 [00:21<00:20,  4.69it/s] 53%|█████▎    | 96/182 [00:24<00:17,  4.95it/s] 59%|█████▉    | 108/182 [00:25<00:13,  5.52it/s] 66%|██████▌   | 120/182 [00:26<00:08,  7.14it/s] 73%|███████▎  | 132/182 [00:27<00:05,  8.45it/s] 79%|███████▉  | 144/182 [00:29<00:05,  6.97it/s] 86%|████████▌ | 156/182 [00:30<00:03,  7.91it/s] 92%|█████████▏| 168/182 [00:33<00:02,  6.38it/s] 99%|█████████▉| 180/182 [00:35<00:00,  6.40it/s]100%|██████████| 182/182 [00:35<00:00,  5.18it/s]
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/positionfixes.py:361: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  pfs["tripleg_id"] = pfs["tripleg_id"].ffill()
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/positionfixes.py:508: UserWarning: The positionfixes with ids [15330821 15330822 18434064 18434065 12805718 12805719 12815040 12815041
 24530048 24530049 19951563 19951564 10651195 10651196 15633919 15633920
 13745057 13745058 23558824 23558825 23734499 23734500 15320862 15320863
 14606581 14606582 24580621 24580622 22164303 22164304] lead to invalid tripleg geometries. The resulting triplegs were omitted and the tripleg id of the positionfixes was set to nan
  warnings.warn(warn_string)
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/triplegs.py:274: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  sp_tpls["is_activity"].fillna(False, inplace=True)
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/triplegs.py:274: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  sp_tpls["is_activity"].fillna(False, inplace=True)
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/triplegs.py:93: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  sp_tpls["temp_trip_id"].ffill(inplace=True)
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/triplegs.py:157: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  trips_with_act["is_activity"].fillna(False, inplace=True)
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/triplegs.py:157: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  trips_with_act["is_activity"].fillna(False, inplace=True)
/usr/local/lib/python3.9/dist-packages/trackintel/analysis/tracking_quality.py:80: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  quality = df.groupby("user_id", as_index=False).apply(_get_tracking_quality_user, granularity)
/content/expr_hrcl_next_pred_av5/preprocessing/utils.py:135: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  df_all.groupby("user_id").apply(lambda x: (x["finished_at"].max() - x["started_at"].min()).days).values
/content/expr_hrcl_next_pred_av5/preprocessing/utils.py:145: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  df_all.groupby("user_id")
/content/expr_hrcl_next_pred_av5/preprocessing/utils.py:145: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  df_all.groupby("user_id")
/usr/local/lib/python3.9/dist-packages/trackintel/preprocessing/staypoints.py:286: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  sp_tpls = pd.concat([sp_merge, tpls_merge]).sort_values(by=["user_id", "started_at"])
/content/expr_hrcl_next_pred_av5/preprocessing/utils.py:77: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  sp = sp.groupby("user_id", group_keys=False).apply(_get_time)
/content/expr_hrcl_next_pred_av5/preprocessing/utils.py:199: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  totalData = totalData.groupby("user_id",group_keys=False).apply(_get_split_days_user)
starting merge (28877, 9) (32970, 5)
finished merge (69999, 13)
**************************************************
182
final selected user 92
After filter non-location staypoints:  19584
Location size:  2049 2049
After staypoints merging:  19191
User size:  91
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:08<00:00,  8.04s/it]100%|██████████| 1/1 [00:08<00:00,  8.04s/it]
/content/expr_hrcl_next_pred_av5/preprocessing/utils.py:199: FutureWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  totalData = totalData.groupby("user_id",group_keys=False).apply(_get_split_days_user)
Max location id:1186, unique location id:1185
Final user size:  45
